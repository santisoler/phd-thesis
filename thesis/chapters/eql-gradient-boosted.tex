\chapter[Fuentes equivalentes potenciadas por gradiente]{
    Fuentes equivalentes potenciadas por gradiente
}
\chaptermark{Fuentes equiv. potenciadas por gradiente}
\label{cha:eql-gradient-boosted}

Este capítulo es una traducción al español del artículo titulado
\emph{Gradient-boosted equivalent sources} escrito por Santiago R. Soler
y Leonardo Uieda, y publicado en \emph{Geophysical Journal
International} en Agosto de 2021 \citep{soler2021}.
Una preimpresión del artículo se encuentra disponible bajo licencia Creative
Commons Atribución 4.0 Internacional en
\href{https://eartharxiv.org/}{EarthArXiv}:
\url{https://doi.org/10.31223/X58G7C}.


% Import files with parameter values generated by notebooks
\input{chapters/eql-gradient-boosted-results.tex}


\section{Introducción}

Las mediciones de las anomalías en los campos potenciales, como el disturbio de
gravedad o anomalías magnéticas, son ampliamente utilizadas en la exploración
geofísica debido a su bajo costo de adquisición.
Estos datos pueden ser recolectados utilizando sistemas terrestres, aéreos,
marítimos o satelitales.
Durante las mediciones terrestres, los datos son recabados siguiendo
trayectorias irregulares a lo largo de la superficie del terreno, produciendo
altas variaciones en la altitud de los puntos de observación en zonas
montañosas.
Las metodologías aéreas y satelitales obtienen los datos a lo largo de líneas
de vuelo, produciendo mediciones muy próximas espacialmente a lo largo de
trayectorias casi rectas, pero con espaciados mucho mayores entre líneas
adyacentes.
La altitud de observación también puede variar en estos casos debido al
movimiento vertical de la aeronave.
El procesado de estos datos suele incluir interpolaciones sobre grillas
regulares a altitudes constante, tanto para mejorar la visualización con el
objetivo de realizar interpretaciones, así como para preparar los datos para
posteriores procesados y/o modelado (por ejemplo, reducción al polo, cálculo de
derivadas, continuación ascendente, deconvolución de Euler).

Existen muchos métodos en la literatura para realizar interpolaciones en dos
dimensiones, por ejemplo splines de curvatura continua en tensión
\citep{smith1990}, splines biharmónicas (placa delgada) \citep{sandwell1987},
y kriging \citep{hansen1993}.
Estos métodos de propósito general poseen limitaciones a la hora de interpolar
datos provenientes de campos potenciales:
(i)~no son capaces de tomar en cuenta las altitudes de los puntos de
observación,
(ii)~las funciones interpoladoras no son necesariamente harmónicas, siendo esta
la principal presuposición de muchas técnicas de procesado (por ejemplo,
continuación ascendente y derivadas verticales).

Un método ampliamente utilizado para interpolar datos gravitatorios
y magnéticos es la técnica de fuentes equivalentes (también conocida como capa
equivalente -\emph{equivalent layer} en inglés-, funciones de bases radiales
-\emph{radial basis functions} en inglés-, o interpolaciones con funciones de
Green).
Inicialmente introducida por \citet{dampney1969}, el método consiste en ajustar
un modelo de finitas fuentes elementales a los datos observados, y luego usar
ese modelo para predecir nuevos valores.
Además de las interpolaciones, las fuentes equivalentes han sido utilizadas
para realizar reducciones al polo de datos magnéticos \citep{silva1986,
nakatsuka2006, guspi2009}, continuación ascendente \citep{emilia1973, li2010},
procesado conjunto de datos del gradiente gravimétrico \citet{barnes2011},
modelado del campo magnético litosférico \citep{kother2015}, recuperación del
vector de inducción magnética a partir de anomalías magnéticas de campo total
\citep{li2020}, entre otras.

Vale nombrar también el método de colocación por mínimos cuadrados
(\emph{least-squares collocation method} en inglés), ampliamente utilizado en
geodesia.
\citep[][y referencias allí citadas]{tscherning2015}.
Esta metodología se suele aplicar para combinar e interpolar diferentes
funciones lineales de anomalías derivadas del potencial gravitatorio (anomalías
de gravedad, disturbio de gravedad, deflexiones de la vertical, altitud del
geoide, etc.).
Al igual que las fuentes equivalentes, el método de colocación requiere
resolver un sistema lineal grande, cuyo orden equivale a la cantidad de datos
observados.
De esta manera, la aplicación práctica de ambos métodos sufren de los mismos
desafíos computacionales.

Muchas variantes de la técnica de fuentes equivalentes han sido propuestas,
usualmente intentando obtener soluciones más precisas o en menor tiempo.
Los factores claves que varían entre ellos son: (i) el tipo de fuente, (ii) la
ubicación de las fuentes, y (iii) la estrategia de solución.

Los tipos de fuentes más utilizados son masas puntuales para datos
gravitatorios o dipolos para datos magnéticos \citep[e.g.,~][]{vonfrese1981,
silva1986, mendonca1994, siqueira2017}.
Sin embargo, también se han utilizado exitosamente prismas rectangulares
\citep[por~ej.,][]{barnes2011, jirigalatu2019, li2020} y tesseroides
\citep{bouman2016}.
De hecho, incluso fuentes puntuales en conjunto con funciones simple como la
inversa de la distancia, en vez del campo gravitatorio o magnético, pueden ser
utilizadas como fuentes equivalentes \citep{cordell1992}.

La ubicación de las fuentes suele elegirse de acuerdo a alguno de las
siguientes estrategias.
El método más común es distribuir las fuentes en una grilla regular a una
profundad constante \citep[por~ej.,~][]{leao1989, barnes2011, oliveira2013}.
Alternativamente, podemos ubicar una fuente debajo de cada punto de observación
\citep[por~ej.,~][]{cordell1992, siqueira2017}.
Algunos trabajos recientes de \citet{li2020} ubican las fuentes en dos capas
superpuestas a profundidades diferentes.

Los coeficientes de las fuentes equivalentes suelen ser estimados mediante
mínimos cuadrados ponderados.
Esto implica una carga computacional alta cuando la cantidad de datos es grande
(por ej. muestras aéreas o satelitales).
Para reducir la carga computacional, \citet{mendonca1994} construyen la
solución iterativamente al tratar un solo dato al mismo tiempo utilizando el
concepto de \emph{dato equivalente}.

\citet{leao1989} procesan los datos de entrada mediante una ventana móvil, solo
ajustando los datos dentro de la ventana y prediciendo las observaciones en su
centro.
\citet{li2010} y \citet{barnes2011} aplican diferentes operaciones para generar
una representación dispersa de la matriz de sensibilidades (\emph{wavelet
compression} y \emph{quadtree discretization}, respectivamente), lo cual mejora
significativamente la velocidad de ejecución del algoritmo de mínimos
cuadrados.
\citet{oliveira2013} parametrizan las fuentes equivalentes como una función
polinomial bivariada a trazos, reduciendo el número de parámetros en la
solución.
\citet{siqueira2017} desarrollaron una solución iterativa en la cual la matriz
de sensibilidades es transformada en una matriz diagonal con términos
constantes a través del concepto de \emph{exceso de masa}.
\citet{jirigalatu2019} aplican el método Gauss-FFT para acelerar las
operaciones vinculadas al modelado directo y resuelven el problema de mínimos
cuadrados utilizando el descenso del gradiente con el objetivo de evitar
calcular las matrices Hessianas y resolver sistemas lineales.


Muchos de los métodos existentes resuelven problemas subdeterminados,
requiriendo un número mayor de fuentes equivalentes que de cantidad de datos.
Algunos de ellos alcanzan mayores eficiencias al
restringir su aplicación a tipos de datos específicos \citep{siqueira2017},
realizar las interpolaciones sobre grillas regulares \citep{leao1989},
o requieren datos ya grillados \citep{takahashi2020},
por nombrar algunos.
Además, muchas de las optimizaciones propuestas son complejas de implementar en
un programa de computación, limitando que sean ampliamente utilizados.

En el presente trabajo, proponemos dos estrategias para reducir el costo
computacional de la técnica de fuentes equivalentes:

\begin{enumerate}
    \item Reducir el número de fuentes equivalentes para muestras con
        sobremuestreo mediante una estrategia de \emph{promedio en
        bloques} (\emph{block-averaging} en inglés), manteniendo la calidad de
        la solución.
    \item Ajustar el modelo de fuentes equivalentes iterativamente sobre
        ventanas solapadas utilizando un algoritmo de \emph{potenciación del
        gradiente} (\emph{gradient-boosting} en inglés) \citep{friedman2001}.
\end{enumerate}

La primera estrategia consiste en dividir el área de estudio en bloques
y asignar una única fuente a cada bloque, localizada en la ubicación media de
los puntos de datos.
Para muestras aéreas, navales y satelitales, las cuales presentan sobremuestreo
a lo largo de la trayectoria del vehículo, esto puede reducir considerablemente
el tamaño del problema inverso manteniendo a su vez la misma calidad en la
interpolación.

El algoritmo de \emph{potenciación del gradiente} permite ajustar el modelo de
fuentes equivalentes de manera iterativa, operando de manera individual sobre
cada una de las ventanas con solapamiento.
Como resultado, nuestro método resuelve muchos problemas de mínimos cuadrados
de menor tamaño en vez de un único gran problema.
Este posee algunas semejanzas con la estrategia utilizada por \citet{leao1989},
pero sin el requerimiento de que tanto las fuentes como los puntos de
interpolación se encuentren en grillas regulares.

Mediantes pruebas sobre datos sintéticos, mostramos que:
(i)~las fuentes \emph{promediadas en bloque} son capaces de alcanzar el mismo
nivel de precisión que otras disposiciones de fuentes equivalentes más
tradicionales, utilizando una fracción del número de fuentes; y
(ii)~el algoritmo \emph{potenciación del gradiente} reduce significativamente la
memoria necesaria para ajustar grandes cantidades de datos, sin sacrificar
precisión en las predicciones.
Finalmente, una combinación de ambas estrategias es utilizada para procesar una
colección de aproximadamente 1.7 millones de datos de gravedad tomados sobre la
superficie de Australia.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Metodología}

\subsection{La técnica de fuentes equivalentes}
\label{sec:equivalent-sources-technique}

De aquí en más seguiremos las \emph{fuentes equivalentes generalizadas}
propuestas por \citet{cordell1992}
y asumiremos que cualquier función harmónica $d(\mathbf{p})$
puede ser aproximada por la suma de los efectos de $M$ fuentes puntuales

\begin{equation}
    d(\mathbf{p})
    =
    \sum\limits_{j=1}^{M} \frac{c_j}{| \mathbf{p} - \mathbf{q}_j
    |} \ ,
    \label{eq:eql-forward}
\end{equation}

\noindent donde $\mathbf{p}$ y $\mathbf{q}_j$ son, respectivamente, los
vectores posición de datos y fuentes en un espacio cartesiano tridimensional,
y $c_j$ es un coeficiente escalar relacionado con la masa puntual localizada en
$\mathbf{q}_j$.
En la sección~\ref{sec:source_distribution} realizamos una discusión acerca de
la distribución horizontal y vertical de las fuentes.

En caso de que poseamos mediciones de nuestra función harmónica en $N$ puntos
de observación
$\{\mathbf{p}_1\ \mathbf{p}_2\ \ldots\ \mathbf{p}_N\}$,
podemos escribir un sistema de $N$ ecuaciones de la forma:

\begin{equation}
    d_i
    =
    \sum\limits_{j=1}^{M} \frac{c_j}{| \mathbf{p}_i - \mathbf{q}_j
    |}
    \quad \forall i=1,2,\ldots,N
    \ ,
    \label{eq:forward-sum}
\end{equation}

\noindent donde $d_i$ es el efecto de las fuentes sobre el punto
$\mathbf{p}_i$.
Estas ecuaciones pueden ser expresadas de forma matricial como:

\begin{equation}
    \mathbf{d} = \mathbf{A} \mathbf{c} \ ,
    \label{eq:linear-problem}
\end{equation}

\noindent donde $\mathbf{d}$ es un vector columna que contiene los $N$ valores
predichos sobre cada punto de observación,
$\mathbf{c}$ es un vector columna formado por los $M$ coeficientes $c_j$ y
$\mathbf{A}$ es la matriz Jacobiana de $N \times M$ elementos,
los cuales se definen como:

\begin{equation}
    a_{ij} = \frac{1}{|\mathbf{p}_i - \mathbf{q}_j|}
\end{equation}

Para un conjunto de $N$ observaciones $\mathbf{d}^o$, podemos hallar la
solución de la ecuación~\ref{eq:linear-problem} mediante mínimos cuadrados y de
esa manera obtener los valores de
$\mathbf{c}$ que mejor ajustan a las observaciones.
Estos coeficientes pueden ser, a su vez, utilizados para predecir los valores
de la función harmónica en cualquier otro punto externo a las fuentes,
evaluando la ecuación~\ref{eq:eql-forward}.
El grillado o la continuación ascendente puede entonces ser realizados mediante
predicciones sobre puntos de una grilla regular o sobre puntos a diferentes
altitudes, respectivamente.


\subsection{Solución por mínimos cuadrados amortiguados}
\label{sec:eql_inversion}

Es posible obtener los valores de los coeficientes $\mathbf{c}$ que mejor
ajustan a los valores observados $\mathbf{d}^o$ minimizando la función objetivo

\begin{equation}
    \phi(\mathbf{c}) =
    \left[\mathbf{d}^o - \mathbf{A}\mathbf{c}\right]\trans
    \mathbf{W}
    \left[\mathbf{d}^o - \mathbf{A}\mathbf{c}\right]
    + \lambda_d\ \mathbf{c}\trans\mathbf{c}
    \ ,
    \label{eq:misfit-unscaled}
\end{equation}

\noindent donde
$\mathbf{W}$ es una matriz diagonal de $N \times N$ elementos que contiene los
pesos ponderados de los datos observados, y
$\lambda_d$ es el parámetro de \emph{amortiguamiento} (\emph{damping} en
inglés), mayor que cero y con las mismas unidades que los elementos de la
matriz Jacobiana.

El segundo término del miembro derecho de la ecuación~\ref{eq:misfit-unscaled}
consiste en una regularización Thikhonov de orden cero \citep{tikhonov1977},
también conocida como regularización de amortiguamiento (\emph{damping
regularization}), que se utiliza para estabilizar la solución.

El parámetro de amortiguamiento controla cuánta regularización será aplicada.
Un valor muy grande generaría soluciones muy suaves que fallarían en reproducir
las componentes de altas frecuencias presente en los datos, mientras que un
valor muy pequeño resultaría en un sobreajuste, produciendo resultados de
interpolación irreales
\citep{martinez2016}.
El rango de valores aceptables para el parámetro de amortiguamiento
$\lambda_d$ dependerá de los valores de la matriz Jacobiana $\mathbf{A}$
y de los coeficientes.
Por lo tanto, este rango puede variar (considerablemente en muchas ocasiones)
entre diferentes conjuntos de datos, haciendo difícil una apropiada elección en
la práctica.

Para resolver esta problema, primero escalaremos la matriz Jacobiana de forma
tal que sus elementos sean adimensionales y que cada columna posea varianza
unitaria.
Definimos la matriz diagonal $\mathbf{S}$ como:

\begin{equation}
    \mathbf{S} =
    \begin{bmatrix}
      \sigma_1 & 0 & \cdots &0 \\
      0 & \sigma_2 & \cdots &0 \\
      \vdots & \vdots & \ddots & \vdots \\
      0  & 0 & \cdots & \sigma_M
    \end{bmatrix}_{M \times M}
    ,
\end{equation}

\noindent donde $\sigma_j$ es la desviación estándar de la columna $j$-ésima
de la matriz $\mathbf{A}$.
Luego reescribimos el problema directo de la ecuación~\ref{eq:linear-problem}
como:

\begin{equation}
    \mathbf{d}
    =
    \mathbf{A} \mathbf{S}\inv \mathbf{S} \mathbf{c}
    =
    \Big[
        \mathbf{A} \mathbf{S}\inv
    \Big]
    \Big[
        \mathbf{S} \mathbf{c}
    \Big]
    =
    \mathbf{B} \mathbf{m}
\end{equation}

\noindent donde $\mathbf{B} = \mathbf{A} \mathbf{S}\inv$ es la matriz Jacobiana
escalda y adimensional, y
$\mathbf{m} = \mathbf{S} \mathbf{c}$ es el vector que contiene los coeficientes
escalados cuyas unidades son las mismas que la de los datos.

La función objetivo definida en la ecuación~\ref{eq:misfit-unscaled} puede ser
reescrita como:

\begin{equation}
    \phi(\mathbf{m}) =
    \left[\mathbf{d}^o - \mathbf{B}\mathbf{m}\right]\trans
    \mathbf{W}
    \left[\mathbf{d}^o - \mathbf{B}\mathbf{m}\right]
    + \lambda\ \mathbf{m}\trans\mathbf{m}
    \ ,
    \label{eq:misfit}
\end{equation}

\noindent donde $\lambda$ es un parámetro de \emph{amortiguamiento
adimensional} y la regularización es aplicada a los coeficientes escalados
$\mathbf{m}$ en vez de al vector $\mathbf{c}$.
Utilizando un parámetro de amortiguamiento adimensional nos permite limitar el
rango de valores de $\lambda$ que generan las predicciones más precisas,
independientemente del set de datos y sus unidades.
A partir de nuestra experiencia, recomendamos buscar valores de $\lambda$ entre
$10^{-6}$ y $10^{4}$ variando por orden de magnitud.
La elección del amortiguamiento y de otros hiperparámetros, como la profundidad
de las fuentes, puede realizarse a través de métodos estadísticos conocidos,
como la validación cruzada.

El vector de coeficientes escalados $\hat{\mathbf{m}}$ que minimiza la función
objetivo puede hallarse resolviendo el \emph{sistema de ecuaciones normales}
\citep{menke1989}:

\begin{equation}
    \left[
      \mathbf{B}\trans \mathbf{W} \mathbf{B} + \lambda \mathbf{I}
    \right]
    \hat{\mathbf{m}} =
    \mathbf{B}\trans\mathbf{W}
    \mathbf{d}^o.
    \label{eq:least_squares_solution}
\end{equation}

Una vez que los coeficientes escalados son obtenidos, los coeficientes sin
escalar
$\hat{\mathbf{c}}$ pueden ser calculados quitando el factor de escalado:

\begin{equation}
    \hat{\mathbf{c}} = \mathbf{S}\inv \hat{\mathbf{m}} \ .
\end{equation}

\noindent Las operaciones relacionadas al modelado directo que se utilizan para
realizar predicciones (por ejemplo, interpolaciones seguidas de continuaciones
ascendentes) permanecen sin variaciones al utilizar el vector
$\hat{\mathbf{c}}$ en vez de $\hat{\mathbf{m}}$.


\subsection{Potenciación del gradiente}

La potenciación del gradiente fue inicialmente introducida por
\citet{friedman2001, friedman2002} como un método para ajustar modelos
paramétricos de manera aditiva de la siguiente forma:

\begin{equation}
    d = \sum_{k=1}^K \alpha_k f(\mathbf{c}_k),
\end{equation}

\noindent donde $\alpha_k$ es un coeficiente llamado \emph{tamaño de paso}
y $f$ es una función del vector de parámetros $\mathbf{c}_k$.
Para problemas lineales, estos modelos aditivos pueden expresarse según la
siguiente ecuación matricial:

\begin{equation}
    \mathbf{d} = \sum_{k=1}^K \mathbf{A}_k \mathbf{c}_k \ .
    \label{eq:gb-linear-model}
\end{equation}

\noindent Dada la linealidad de la funciones $f(\mathbf{c}_k)$, los parámetros
de tamaño de paso $\alpha_k$ pueden ser incluidos en el vector de parámetros
$\mathbf{c}_k$.

Aplicando esta técnica al problema de fuentes equivalentes, podemos transformar
la ecuación~\ref{eq:linear-problem} en un modelo aditivo siguiendo estos
pasos:

\begin{enumerate}
  \item Definir un conjunto de $M$ fuentes equivalentes distribuidas a lo
      largo de la zona de estudio (ver sección~\ref{sec:source_distribution}
      para más detalles).
  \item Definir un conjunto de $K$ ventanas solapadas de igual tamaño que
      cubren toda la zona de estudio.
  \item Crear $K$ conjuntos distintos de fuentes equivalentes, uno por cada
      ventana.
      Cada conjunto estará conformado por la proción de las $M$ fuentes
      originales que caen dentro de la respectiva ventana.
      Dado que las ventanas se solapan, el número total de fuentes considerando
      cada uno de los conjuntos será mayor que $M$.
  \item Definir el vector $\mathbf{c}_k$ como los $M_k$ coeficientes
      correspondientes a las fuentes equivalentes de la ventana $k$-ésima.
  \item Definir la matriz $\mathbf{A}_k$ como la matriz Jacobiana de $N \times
      M_k$ elementos entre las fuentes de la ventana $k$-ésima y todos los $N$
      puntos de datos de la muestra.
  \item Modelar los datos predichos por las fuentes como una superposición de
      los efectos de los $K$ conjuntos de fuentes equivalentes
      (ec.~\ref{eq:gb-linear-model}).
\end{enumerate}

El algoritmo de potenciación del gradiente funciona ajustando cada componente
del modelo aditivo, una a la vez, a los residuos de la componente anterior.
\citet{friedman2001} demuestra que esto corresponde a una optimización por
descenso del gradiente en el \emph{espacio funcional}.
El Algoritmo~\ref{alg:gradient_boosting} presenta nuestra adaptación del
algoritmo de potenciación del gradiente para hallar las soluciones  de los $K$
vectores de parámetros $\mathbf{c}_k$ de la ec.~\ref{eq:gb-linear-model}
mediante mínimos cuadrados amortiguados.

\begin{algorithm}[!h]
  \DontPrintSemicolon
  \linespread{1.5}\selectfont
  Definir el vector residual $\mathbf{r}_{0} = \mathbf{d}^o$ \;
  \For{ $k = 1$ \KwTo $K$ }{


      Calcular la matriz Jacobiana $\mathbf{A}_k$ de $N \times M_k$ elementos
      \;

      $\mathbf{B}_k = \mathbf{A}_k \mathbf{S}_k\inv$
      \nllabel{alg:scale}
      \;

      $
       \hat{\mathbf{m}}_k = \left[\mathbf{B}_k\trans \mathbf{W}_k \mathbf{B}_k +
       \lambda \mathbf{I} \right]\inv \mathbf{B}_k\trans \mathbf{W}_k
       \mathbf{r}_{k-1}
      $
      \nllabel{alg:fit}
      \;

      $\hat{\mathbf{c}}_k = \mathbf{S}_k\inv \hat{\mathbf{m}}_k$
      \nllabel{alg:unscale}
      \;

      $\mathbf{d}_k = \mathbf{A}_k \hat{\mathbf{c}}_k$
      \nllabel{alg:predicted}
      \;

      $\mathbf{r}_k = \mathbf{r}_{k - 1} - \mathbf{d}_k$
      \nllabel{alg:residual}
      \;
  }
  \BlankLine
  \linespread{1}\selectfont
  \caption{
      Solución mediante potenciación del gradiente de una regresión por mínimos
      cuadrados amortiguados.
  }
  \label{alg:gradient_boosting}
\end{algorithm}

Luego de que todo los vectores de coeficientes $\mathbf{c}_k$ fueron estimados,
podemos predecir el efecto del modelo aditivo de fuentes equivalentes mediante
la suma

\begin{equation}
    d(\mathbf{p}) =
    \sum\limits_{k=1}^K \sum\limits_{j=1}^{M_k}
    \frac{{c_k}_j}{| \mathbf{p} - {\mathbf{q}_k}_j |}
    \ ,
    \label{eq:eql-forward-gb}
\end{equation}

\noindent donde ${c_k}_j$ es el $j$-ésimo elemento del vector $\mathbf{c}_k$
y ${\mathbf{q}_k}_j$ es el vector posición de la $j$-ésima fuente de la
$k$-ésima ventana.

Para mejorar la convergencia del algoritmo, \citet{friedman2002} sugiere
introducir aleatoriedad en el proceso de ajuste.
En nuestra adaptación logramos esto aleatorizando el orden en el cual las $K$
ventanas son utilizadas durante el algoritmo de potenciación de gradiente.
La sección~\ref{sec:gb_interpolation} explora los efectos de la aleatorización
sobre la velocidad de convergencia del algoritmo y sobre la precisión de la
interpolación.

Las matrices $\mathbf{A}_k$ poseen solo $N \times M_k$ elementos (donde $M_k$
es la cantidad de fuentes dentro de la ventana $k$-ésima), las cuales pueden
ser considerablemente más pequeñas que la matriz $\mathbf{A}$ con $N \times M$
elementos.
Por lo tanto, el algoritmo de potenciación del gradiente permite ajustar
modelos de fuentes equivalentes cuyas matrices Jacobianas fueran más grandes
que la memoria computacional disponible.
Además, podemos incrementar o disminuir el tamaño de las ventanas según lo
necesario, dependiendo de la cantidad de fuentes en el modelo y de la memoria
disponible.

Podemos mejorar la eficiencia del algoritmo aún más mediante:

\begin{enumerate}
  \item La utilización de solo los $N_k$ puntos de datos que caen dentro de la
      ventana $k$-ésima a la hora de ajustar los coeficientes de las fuentes
      (pasos \ref{alg:scale} y \ref{alg:fit} del
      algoritmo~\ref{alg:gradient_boosting}).
      De esta manera, podemos reemplazar las matrices Jacobianas $\mathbf{A}_k$
      de $N \times M_k$ elementos por matrices $\tilde{\mathbf{A}}_k$ más
      pequeñas de $N_k \times M_k$ elementos.
      Seguiremos utilizando todos los $N$ puntos de datos cuando calculamos los
      valores predichos y los residuos (pasos \ref{alg:predicted}
      y \ref{alg:residual} del algoritmo~\ref{alg:gradient_boosting}).
  \item La operación de modelado directo que se realiza en el paso
      \ref{alg:predicted} puede ser llevada a cabo mediante una suma
      (ec.~\ref{eq:forward-sum}), en vez de un producto matricial, lo cual
      permite evitar almacenar en memoria la matriz $\mathbf{A}_k$ de $N \times
      M_k$ elementos.
\end{enumerate}

El Algoritmo~\ref{alg:gradient_boosting_window} sintetiza el definitivo
\textit{algoritmo de fuentes equivalentes potenciadas por gradiente},
incorporando estas últimas modificaciones.
La Figura~\ref{fig:gradient-boosting-schematics} muestra un bosquejo de los
pasos del algoritmo aplicado a un conjunto de puntos de observación que simulan
una muestra sobre el terreno y ubicando una fuente debajo de cada punto de
observación.

\begin{algorithm}[!h]
  \DontPrintSemicolon
  \linespread{1.5}\selectfont
  Definir el vector residual $\mathbf{r}_{0} = \mathbf{d}^o$ \;
  \For{ $k = 1$ \KwTo $K$ }{

      Seleccionar los pesos ponderados $\tilde{\mathbf{W}}_k$ y residuos
      $\tilde{\mathbf{r}}_{k - 1}$ correspondientes a los puntos de datos que
      caen dentro de la $k$-ésima ventana
      \;

      Calcular la matriz Jacobiana $\tilde{\mathbf{A}}_k$ considerando puntos
      de datos y fuentes dentro de la $k$-ésima ventana
      \;

      $\mathbf{B}_k = \tilde{\mathbf{A}}_k \mathbf{S}_k\inv$
      \;

      $
       \hat{\mathbf{m}}_k = \left[
       \mathbf{B}_k\trans \tilde{\mathbf{W}}_k \mathbf{B}_k +
       \lambda \mathbf{I} \right]\inv \mathbf{B}_k\trans \tilde{\mathbf{W}}_k
       \tilde{\mathbf{r}}_{k-1}
      $
      \;

      $\hat{\mathbf{c}}_k = \mathbf{S}_k\inv \hat{\mathbf{m}}_k$
      \;

      Calcular $ \mathbf{d}_k $, donde
      $
      {d_k}_i
      =
      \sum\limits_{j=1}^{M_k} \dfrac{{c_k}_j}{| \mathbf{p}_i -
          {\mathbf{q}_k}_j
      |}
      \quad \forall\ i=1\ \text{to}\ N
      $
      \;

      $\mathbf{r}_k = \mathbf{r}_{k - 1} - \mathbf{d}_k$
      \;
  }
  \BlankLine
  \linespread{1}\selectfont
  \caption{Algoritmo de fuentes equivalentes potenciadas por gradiente.}
  \label{alg:gradient_boosting_window}
\end{algorithm}

\begin{figure}[tb]
    \centering
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/gradient-boosting-schematics.pdf}
    \caption{
        Bosquejo del algoritmo de fuentes equivalentes potenciadas por el
        gradiente.
        Los puntos de datos están representados por triángulos azules
        (orientados hacia arriba), las fuentes equivalentes por puntos naranja,
        los residuos por triángulos rojos (orientados hacia abajo), y los
        límites de la ventana actual por líneas negras de a trazos.
        El algoritmo comienza seleccionado los datos y las fuentes que caen
        dentro de la primer ventana y continua estimando los coeficientes de
        estas fuentes utilizando los puntos de datos seleccionados.
        Luego, se calcula el efecto de las fuentes ajustadas sobre todos los
        puntos de observación y usamos los datos para calcular los residuos.
        Se utiliza otra ventana para seleccionar otro conjunto de residuos
        y fuentes, se estiman sus coeficientes utilizando los residuos
        seleccionados en vez de los datos originales.
        Nuevamente, el efecto de las fuentes estimadas es calculado sobre todos
        los puntos de observación y se actualizan los residuos.
        Estos pasos son repetidos para cada ventana en orden aleatorio.
    }
    \label{fig:gradient-boosting-schematics}
\end{figure}

Vale la pena notar que los dos conjuntos de fuentes equivalentes
correspondientes a dos ventanas solapadas contiguas poseen una porción de sus
fuentes las mismas ubicaciones, específicamente aquellas que caen en la
intersección de ambas ventanas.
Esto nos permite interpretar que el algoritmo de potenciación de gradiente
ajusta los coeficientes de las fuentes múltiples veces: una vez por cada
ventana que cubre cada una de las fuentes.
Este hecho puede ser explotado con el objetivo de ahorrar memoria.
En vez de almacenar todos los vectores $\mathbf{c}_k$
(ec.~\ref{eq:gb-linear-model}), podemos inicializar un único vector
$\mathbf{c}$ con ceros, donde cada elemento representa el coeficiente de cada
una de las $M$ fuentes originales.
Luego de cada iteración del algoritmo de potenciación por gradiente, añadimos
los coeficientes estimados $\hat{\mathbf{c}}_k$ a sus correspondientes
elementos del vector
$\mathbf{c}$.
Dado que la función de modelado directo es lineal, podemos calcular el campo
resultante mediante la ec.~\ref{eq:eql-forward} en vez de utiliza la
ec.~\ref{eq:eql-forward-gb}.
De esta forma, la cantidad de memoria necesaria para almacenar el conjunto
completo de coeficientes se limita a un único vector de $M$ elementos.

Nuestro algoritmo de potenciado por el gradiente es similar a la \emph{boostrap
inversion} utilizada por \citet{vonfrese1988}, la cual también ajusta
iterativamente porciones del modelo de fuentes equivalentes a datos residuales.
Las diferencias claves entre este y nuestro método son:
(i)~las fuentes en las porciones de solapamiento de las ventanas son ajustadas
más de una vez, permitiendo al algoritmo autocorregirse en caso de soluciones
de baja calidad sobre alguna de las ventanas;
(ii)~utilizamos solo los datos dentro de las ventanas durante el ajuste, lo
cual permite la aplicación del algoritmo a conjuntos de datos más grandes.


\subsection{Ubicación de las fuentes}
\label{sec:source_distribution}

La cantidad ideal de fuentes y sus ubicaciones, tanto horizontales como
verticales, han sido debatidas desde la concepción de la técnica de fuentes
equivalentes de la mano de \citet{dampney1969}.
Las elecciones que se realizan con respecto a estos parámetros juegan un rol
importante en la precisión de las predicciones y de los recursos
computacionales necesarios para estimar los coeficientes de las fuentes.
Una distribución ideal de fuentes debería ser simultáneamente capaz de
reproducir los datos observados en los puntos de muestreo, realizar
predicciones precisas en locaciones no muestreadas y minimizar el costo
computacional necesario.

Un gran número de fuentes homogéneamente distribuidas a lo largo y ancho de la
zona de estudio son capaces de reproducir los datos observados.
Sin embargo, los costos computacionales pueden ser prohibitivos y los problemas
subdeterminados que generan son susceptibles a sobreajustar a los datos,
resultando en interpolaciones y extrapolaciones de baja calidad.
En el otro extremo, la utilización de pocas fuentes reduciría el costo
computacional, pero el modelo podría ser incapaz de reproducir el espectro
completo de los datos observados.

Las características particulares de cada muestra juegan también un rol
importante en la elección de la distribución de las fuentes equivalentes.
En el caso de muestras tomadas sobre la superficie terrestre, las observaciones
suelen localizarse a lo largo de trayectorias irregulares junto con algunos
puntos dispersos.
La cobertura de la región de muestreo es usualmente despareja, dejando grandes
áreas sin ninguna medición.
Por otro lado, las observaciones realizadas mediante vehículos aéreos suelen
estar localizadas a lo largo de líneas de vuelo casi rectas y con poca
separación.
Las mediciones se suelen tomar a intervalos muy cortos, produciendo una gran
densidad de datos a lo largo de las líneas de vuelo.
Esto genera un sesgo en el muestreo, lo cual puede producir artefactos de
\emph{aliasing} en las grillas posteriores.

\subsubsection{Distribuciones horizontales de las fuentes}

\begin{figure}[tb]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/source-layouts-schematics.pdf}
    \caption{
        Bosquejo de las diferentes distribuciones horizontales para los modelos
        de fuentes equivalentes.
        Los puntos azules representan las ubicaciones de las observaciones,
        y los puntos naranja, las ubicaciones de las fuentes equivalentes según
        las distintas estrategias de distribución.
        (a)~Conjunto de \SourceLayoutsSchematicsObservations{} puntos de
        observación que emulan una muestra terrestre.
        (b)~Ubicación de \SourceLayoutsSchematicsSourceBelowData{} fuentes
        obtenidas mediante la distribución \emph{fuentes debajo de datos}.
        (c)~Ubicación de \SourceLayoutsSchematicsGridSources{} fuentes
        obtenidas mediante la distribución \emph{grilla regular}.
        (d)~Ubicación de \SourceLayoutsSchematicsBlockAveragedSources{} fuentes
        obtenidas mediante la distribución \emph{fuentes promediadas por
        bloque}. Las líneas de a trazos grises representan los bloques
        espaciales dentro de los cuales la localización media de los datos es
        calculada.
    }
    \label{fig:source_layouts}
\end{figure}

Las distribuciones más utilizadas para localizar las fuentes equivalentes
horizontalmente son:

\begin{enumerate}
  \item
    \emph{Fuentes debajo de datos}: una única fuente equivalente es ubicada en
    la misma localización horizontal de cada dato
    (fig.~\ref{fig:source_layouts}b), pero a diferente altitud. Por lo tanto,
    la cantidad de fuentes es igual a la cantidad de observaciones ($M=N$).
  \item
    \emph{Grilla regular}: una distribución homogénea de fuentes debajo de la
    zona de estudio (fig.~\ref{fig:source_layouts}c). En la práctica, esto
    suele generar problemas subdeterminados, ya que se requieren mayores
    cantidades de fuentes que de datos ($M>N$).
\end{enumerate}

En el caso de muestras terrestres, la distribución de \emph{grilla regular}
necesita un espaciado entre los nodos lo suficientemente pequeño para poder ser
capaz de ajustar a los datos observados.
Esto genera una cantidad de fuentes innecesariamente grande en regiones donde
no se han realizado observaciones.
En contraste, la distribución \emph{fuentes debajo de datos} es más propensa
a ajustar de manera precisa a los datos observados haciendo uso de una cantidad
menor de fuentes, y por ende reduciendo el costo computacional.
Sin embargo, cuando esta distribución es aplicada a muestras aéreas, la
distribución \emph{fuentes debajo de datos} ubicará una cantidad
indeseablemente grande de fuentes debajo de las líneas de vuelo.
Esto puede conllevar la generación de efectos de \emph{aliasing} sobre los
valores predichos, como un patrón de rayas paralelas a las líneas de vuelo que
suelen observarse en grillas obtenidas de vuelos aeromagnéticos.
La distribución de \emph{grilla regular} puede evitar estos efectos al
distribuir homogéneamente las fuentes y utilizando una capa de fuentes de
densidades continuas (por ejemplo, prismas rectangulares o tesseroides).

Aquí proponemos un nuevo tipo de distribución horizontal de fuentes
equivalentes que puede simultáneamente reducir el costo computacional y mitigar
algunas de las desventajas de las distribuciones existentes.
En la distribución de \emph{fuentes promediadas por bloque}
(\emph{block-averaged sources} en inglés), cada fuente es ubicada en la
posición media de los puntos de datos que caen dentro de un determinado bloque
espacial (fig.~\ref{fig:source_layouts}d).
Esto se realiza de la siguiente forma:

\begin{enumerate}
    \item Dividir la región de estudio en bloques rectangulares de mismo
        tamaño.
    \item \label{item:median-position} Calcular la media de las posiciones
        horizontales de los puntos de observación que caen dentro de cada
        bloque. Los bloques sin ningún punto de observación son omitidos.
    \item Asignar una fuente puntual a cada posición horizontal media calculada
        en el paso \ref{item:median-position}.
\end{enumerate}

La cantidad total de fuentes creadas por esta nueva distribución será menor que
el número total de observaciones si el tamaño de los bloques es elegido
apropiadamente (asegurándose de que los bloques sean lo suficientemente grandes
como para contener más de un único punto de observación).
El problema sobredeterminado que surge de esta distribución posee un costo
computacional inferior y es menos propenso a sobreajustar los datos, ya que la
complejidad del modelo es menor.
Además, el proceso de \emph{promediado por bloques} puede balancear el
espaciado entre fuentes a lo largo de líneas de vuelo y entre líneas contiguas,
ayudando a reducir los efectos de \emph{aliasing} en las grillas que se
generan.
En la sección~\ref{sec:synthetic_distributions}, demostramos mediante pruebas
sobre datos sintéticos que las \emph{fuentes promediadas por bloque} son
capaces de realizar interpolaciones con una precisión comparable a la obtenida
por las otras dos distribuciones, pero utilizando una fracción de fuentes
equivalentes.


\subsubsection{Profundidad de las fuentes}

\begin{figure}[tb]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/depth_types.pdf}
    \caption{
        Ejemplos de diferentes estrategias para asignar profundidades a las
        fuentes equivalentes.
        Asignaremos una única fuente por cada punto de observación,
        localizándolas en la mismas coordenadas horizontales que los puntos de
        datos.
        Las profundidades de las fuentes son
        (a)~una \emph{profundidad constante} a una determinada coordenada
        vertical,
        (b)~una \emph{profundidad relativa} determinada al desplazar
        uniformemente la coordenada vertical de los puntos de datos hacia
        abajo, y
        (c)~una \emph{profundidad variable} determinada por el desplazamiento
        de la coordenada vertical de los puntos de observación por una cantidad
        proporcional a la distancia media entre fuentes vecinas.
        La distancia entre puntos de datos y sus respectivas fuentes (a)
        depende de la altitud de las observaciones, (b) es constante, y (c) es
        proporcional a la distancia horizontal de las fuentes.
        Vale notar cómo las fuentes agrupadas en el centro del perfil (c) se
        encuentran más someras que sus contrapartes en (b).
    }
    \label{fig:depth_types}
\end{figure}

Es ampliamente conocido de la teoría de potencial que la profundidad de una
fuente puntual influencia la longitud de onda del campo observado en la
superficie.
Esto hace que la profundidad de la fuente sea un parámetro clave que afecta el
producto de la interpolación y otras operaciones realizadas mediante fuentes
equivalentes.
En la literatura podemos encontrar múltiples estrategias diferentes para
asignar profundidad de las fuentes.
Aquí destacaremos las siguientes (fig.~\ref{fig:depth_types}):

\begin{enumerate}
  \item
    \emph{Profundidad constante}:
    La opción más simple es ubicar todas las fuentes a la misma profundidad
    (fig.~\ref{fig:depth_types}a).
    Si las mediciones fueron obtenidas a altitudes significativamente diversas,
    algunas mediciones se encontrarán más distantes a las fuentes que otras,
    lo que podría generar problemas a la hora de reproducir las longitudes de
    onda más cortas en los puntos de grandes altitudes.
 \item
    \emph{Profundidad relativa}:
    Las profundidades de las fuentes se determinan al desplazar la coordenada
    vertical de los puntos de datos hacia abajo por una cantidad constante
    (fig.~\ref{fig:depth_types}b).
    Las fuentes no tendrán todas las mismas coordenadas verticales, pero se
    encontrarán todas a la misma distancia vertical con respecto a los puntos
    de observación.
 \item
    \emph{Profundidad variable}:
    Las profundidades de las fuentes son proporcionales a la distancia
    horizontal entre primeros vecinos de datos o fuentes
    (fig.~\ref{fig:depth_types}c).
    Diferentes variaciones de esta estrategia han sido propuestas
    anteriormente, por ejemplo
    \citet{cordell1992}, \citet{guspi2004}, y \citet{guspi2009}.
    La razón fundamental para utilizar esta estrategia surge en caso de que la
    muestra posea puntos muy agrupados (formando \emph{clusters} o cúmulos) en
    algunas áreas, es posible que deseemos ubicar las fuentes debajo de ellas
    a menores profundidades, con el objetivo de preservar las longitudes de
    onda más cortas presentes en esos datos.
\end{enumerate}

Nuestro enfoque sobre la estrategia de \emph{profundidad variable} será:

\begin{equation}
  z = z_{obs} + \Delta z + \alpha h,
  \label{eq:variable_depth}
\end{equation}

\noindent
donde $z$ es la coordenada vertical (positiva hacia abajo) de una fuente
equivalente,
$\Delta z$ es un desplazamiento relativo en profundidad que se aplica de manera
uniforme a todas las fuentes,
$\alpha$ es un \emph{factor de profundidad} adimensional,
$h$ es la distancia horizontal media a las primeras $k$ fuentes vecinas,
y
$z_{obs}$ es una coordenada vertical relacionada a los puntos de observación
que dependerá de la estrategia horizontal utilizada.
Para \emph{fuentes debajo de datos}, será la coordenada vertical del
punto de observación correspondiente a la fuente.
Para una \emph{grilla regular}, puede ser interpolada a partir de la coordenada
vertical de todos los puntos de datos.
Finalmente, para \emph{fuentes promediadas por bloque} será la coordenada
vertical media de todos los puntos de datos que caen dentro del bloque
correspondiente a la fuente.

En la sección~\ref{sec:synthetic_distributions}, probamos la efectividad de
estas estrategias sobre datos sintéticos.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Pruebas sobre datos sintéticos}

\begin{figure}[tb]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/synthetic-survey-layouts.pdf}
    \caption{
        Altitudes de los puntos de observación y valores de gravedad para las
        muestras sintéticas sobre terreno (a-b) y aéreas (c-d).
        Las altitudes están dadas en metros sobre el plano de altitud cero.
        Los datos sintéticos de gravedad están contaminados con ruido Gaussiano
        pseudo-aleatorio con media cero y desviación estándar de
        \SurveyNoise{}.
    }
    \label{fig:synthetic-layouts}
\end{figure}

\begin{figure}[tb]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/eql-gradient-boosted/target-grid.pdf}
    \caption{
        Gráfico de la \emph{grilla objetivo} de datos sintéticos de gravedad.
        La grilla está compuesta por
        \TargetEastingSize{}$\times$\TargetNorthingSize{} puntos
        con un espaciado de \TargetSpacing{}.
        Todos los puntos de la grilla se encuentran a una altitud de
        \TargetHeight{} sobre el plano de altitud cero.
    }
    \label{fig:synthetic-target}
\end{figure}

Hemos utilizado un conjunto de datos sintéticos de gravedad para probar la
precisión de la interpolación entre las diferentes estrategias de distribución
horizontal y vertical de fuentes equivalentes, así como también el desempeño
del algoritmo de fuentes equivalentes potenciadas por gradiente.
Para generar los datos sintéticos hemos creado un modelo de
\NPrisms{} prismas rectangulares, distribuidos a lo largo y ancho de un área de
\ModelEasting{}$\times$\ModelNorthing{} con profundidades variables entre
\ModelDepth{} y cero.
El contraste de densidad de los prismas van desde \ModelMinDensity{} a
\ModelMaxDensity{}.
El modelo incluye prismas de diferentes formas, tamaños y profundidades para
crear disturbio de gravedad con una variedad de longitudes de onda.

Hemos creado dos conjuntos de datos sintéticos a partir del mismo modelo, uno
que simula un muestreo sobre el terreno y otro una campaña aérea
(fig.~\ref{fig:synthetic-layouts}).
Para crear la muestra sintética sobre el terreno hemos elegido una porción de
las observaciones presentes en un conjunto de datos de dominio público sobre
Sudáfrica, disponibles a través del NOAA National Centers for Environmental
Information (NCEI). Para la muestra aérea, utilizamos una porción de la Great
Britain Aeromagnetic Survey adquirida por Hunting Geology and Geophysics Ltd
y Canadian Aeroservices Ltd, entre 1955 y 1965, y puesta a disposición pública
por el British Geological Survey (BGS).
En ambos casos, re-escalamos las coordenadas horizontales de cada porción de
muestra para cubrir un área de \SurveyEasting{}$\times$\SurveyNorthing{},
coincidentes con las dimensiones del modelo sintético.
La muestra sintética sobre el terreno contiene \GroundSurveyPoints{}
observaciones distribuidas en altitudes que van desde \GroundSurveyMinHeight{}
y \GroundSurveyMaxHeight{} (fig.~\ref{fig:synthetic-layouts}a).
La muestra aérea posee \AirborneSurveyPoints{} observaciones a altitudes entre
\AirborneSurveyMinHeight{} y \AirborneSurveyMaxHeight{}
(fig.~\ref{fig:synthetic-layouts}c).

Calculamos la componente vertical de la aceleración gravitatoria generada por
el modelo sintético utilizando el método de \citet{nagy2000, nagy2002} con
recientes modificaciones hechas por \citet{fukushima2020}, como se ha
implementado en el software de código abierto Harmonica \citep{harmonica2021}.
Hemos generado una \emph{grilla objetivo} de
\TargetEastingSize{}$\times$\TargetNorthingSize{} puntos con un espaciado de
\TargetSpacing{} y localizados a una altitud de \TargetHeight{} sobre el plano
de altitud cero (fig.~\ref{fig:synthetic-target}) que nos servirá de referencia
para estimar los errores de las interpolaciones.
Luego generamos los datos sintéticos de aceleración de la gravedad sobre la
muestra sobre el terreno (fig.~\ref{fig:synthetic-layouts}b) y sobre la muestra
aérea (fig.~\ref{fig:synthetic-layouts}d).
Además hemos contaminado estos datos sintéticos con ruido Gaussiano
pseudo-aleatorio con media cero y con desviación estándar de \SurveyNoise{}.


\subsection{Estrategias de distribución de fuentes}
\label{sec:synthetic_distributions}

\begin{figure}[p]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/ground_survey_differences.pdf}
    \caption{
        Gráficos con las diferencias entre la \emph{grilla objetivo} y los
        valores interpolados para la muestra sobre el terreno, producidas por
        cada una de las estrategias de distribución de fuentes.
        Los puntos negros representan la ubicación horizontal de los puntos
        correspondientes a los datos sintéticos.
        La \acs{RMSE} y el número total de fuentes equivalentes para cada
        distribución se encuentran reportadas por encima del respectivo
        gráfico.
    }
    \label{fig:ground-survey-differences}
\end{figure}

\begin{figure}[p]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/airborne_survey_differences.pdf}
    \caption{
        Gráficos con las diferencias entre la \emph{grilla objetivo} y los
        valores interpolados para la muestra aérea, producidas por
        cada una de las estrategias de distribución de fuentes.
        Los puntos negros representan la ubicación horizontal de los puntos
        correspondientes a los datos sintéticos.
        La \acs{RMSE} y el número total de fuentes equivalentes para cada
        distribución se encuentran reportadas por encima del respectivo
        gráfico.
    }
    \label{fig:airborne-survey-differences}
\end{figure}

Hemos investigado el efecto sobre la precisión de las interpolaciones de
diferentes estrategias para distribuir las fuentes equivalentes, tanto
horizontal como verticalmente.
Para hacer esto, hemos utilizado las soluciones por mínimos cuadrados
amortiguados descriptas en la sección~\ref{sec:eql_inversion} (sin potenciación
del gradiente) para interpolar los datos sintéticos
(fig.~\ref{fig:synthetic-layouts}) y comparamos los resultados con los valores
de la \emph{grilla objetivo} (fig.~\ref{fig:synthetic-target}).
Este proceso es repetido para cada una de las combinaciones de distribución
horizontal (\emph{fuentes debajo de datos} y \emph{fuentes promediadas por
bloque}) y tipo de profundidad (\emph{constante}, \emph{relativa},
y \emph{variable}), y para fuentes distribuidas en una \emph{grilla regular}
con profundidad constante.
En total se generan 7 diferentes tipos de combinaciones.

Cada estrategia de distribución de fuentes requiere seleccionar valores para
determinados hiperparámetros necesarios para construir, en cada caso, el
conjunto de fuentes equivalentes.
Por ejemplo, al utilizar una profundidad constante necesitamos definir la
profundidad de las fuentes, y si la combinamos con \emph{fuentes promediadas
por bloques} se requiere el tamaño de los bloques.
Las capacidades predictivas de las fuentes equivalentes depende de la elección
de estos hiperparámetros.
Para garantizar que nuestras comparaciones sean justas, llevamos a cabo
exhaustivas búsquedas sobre las combinaciones de los hiperparámetros
(incluyendo el parámetro de \emph{amortiguamiento} de la ec.~\ref{eq:misfit})
con el objetivo de obtener las mejores predicciones que puedan ser alcanzadas
por cada estrategia de distribución de fuentes.
La mejor predicción se define como aquella que minimiza la \ac{RMSE} entre los
valores interpolados y los valores de la \emph{grilla objetivo}
(fig.~\ref{fig:synthetic-target}).
Los valores para cada uno de los parámetros utilizados en estas búsquedas
y aquellos que producen la menor \ac{RMSE} se exponen en las
Tablas~\ref{tab:parameters-ground-survey}
y~\ref{tab:parameters-airborne-survey}.

Las Figuras.~\ref{fig:ground-survey-differences}
y~\ref{fig:airborne-survey-differences}
muestran las diferencias entre la \emph{grilla objetivo} y las mejores
predicciones alcanzadas por cada estrategia de distribución de fuentes, tanto
para la muestra sobre el terreno como para la muestra aérea, respectivamente.
En el caso de la muestra sintética sobre el terreno, las distribuciones
horizontales produjeron valores similares de \ac{RMSE} de aproximadamente
0.8\mGal{}, independientemente del tipo de profundidad que se utilice;
a excepción de las fuentes distribuidas sobre una \emph{grilla regular}, la
cual produjo una \ac{RMSE} mayor de
\BestGroundGridSourcesConstantDepthRms{}\mGal{}.
Las diferencias entre la \emph{grilla objetivo} y los valores interpolados son
mayores en regiones con una pobre cobertura de datos.
Los efectos de borde están presentes en todas las estrategias, pero son
notablemente menores para la combinación de \emph{fuentes promediadas por
bloque} con profundidad variable.
En el caso de la muestra aérea, todas las estrategias (incluyendo la grilla
regular) produce valores similares de \ac{RMSE} de aproximadamente 0.3\mGal{}.
Los gráficos de las diferencias entre la \emph{grilla objetivo} y los valores
interpolados son visualmente indistinguibles entre ellos.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\subsection{Tamaño de las ventanas y cantidad de solapamiento en potenciación
del gradiente}
\label{sec:window_size_and_overlap}

Hemos analizado la relación entre la precisión de las interpolaciones y el
tiempo de cómputo del algoritmo de fuentes equivalentes potenciadas por el
gradiente en función de dos factores claves: el tamaño de las ventanas y la
cantidad de solapamiento entre ventanas contiguas.
Las comparaciones fueron realizadas contra la solución obtenida por mínimos
cuadrados amortiguados (ec.~\ref{eq:least_squares_solution}, sin potenciación
del gradiente) utilizando los datos provistos por la muestra aérea sintética
(fig.~\ref{fig:synthetic-layouts}c-d).
Para evitar que existan sesgos en los resultados, utilizamos las mismas
ubicaciones para las fuentes equivalentes tanto como para las interpolaciones
con y sin potenciación del gradiente.
Más precisamente, elegimos fuentes promediadas por bloques con un tamaño de
bloque de
\BestAirborneBlockAveragedSourcesRelativeDepthSpacing\m{} y una profundidad
relativa de
\BestAirborneBlockAveragedSourcesRelativeDepthDepth\m{}.

\subsubsection{Tamaño de las ventanas}
\label{sec:window_size}

El tamaño de las ventanas controla el tamaño de las matrices Jacobianas
$\tilde{\mathbf{A}}_k$ al limitar la cantidad de puntos de datos y fuentes
equivalentes que se utilizan en cada paso del algoritmo de potenciación del
gradiente
(alg.~\ref{alg:gradient_boosting_window}).
Por lo tanto, ventanas pequeñas reducen la cantidad total de memoria necesaria
para estimar los coeficientes de las fuentes.
Sin embargo, estas pueden producir interpolaciones menos precisas al no ser
capaces de alcanzar el mínimo global de la función objetivo en la
ec.~\ref{eq:misfit}.
El tamaño de la ventana también impacta en el tiempo de cómputo de formas poco
intuitivas, ya que ventanas pequeñas generan problemas de mínimos cuadrados más
simples, pero también requieren mayor cantidad de iteraciones del algoritmo de
potenciación del gradiente.

Hemos calculado la \ac{RMSE} de las interpolaciones (entre el resultado de la
interpolación y la \emph{grilla objetivo} de la
fig.~\ref{fig:synthetic-target}) y registramos los tiempos de cómputo
utilizando un valor fijo de solapamiento entre ventanas de 50\% y varios
tamaños de ventanas diferentes.
Para evitar sesgos introducidos por un determinado ordenamiento aleatorio
particular de las ventanas, los cálculos fueron repetidos utilizando diferentes
\emph{semillas} para el generado de números pseudo-aleatorios.
La Figura~\ref{fig:gradient-boosted-comparison}a
muestra la \ac{RMSE}, y
la Figura~\ref{fig:gradient-boosted-comparison}c
el tiempo de cómputo requerido para estimar los coeficientes de las fuentes,
ambos en función del tamaño de las ventanas.

\begin{figure}[tb]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/gradient-boosted-comparisons.pdf}
    \caption{
        \acs{RMSE} de las interpolaciones (a-b) y los tiempos de cómputos
        relativos (c-d) para fuentes equivalentes regulares (líneas naranja de
        a trazos) y para fuentes equivalentes potenciadas por gradiente
        (puntos azules con barras de error).
        El solapamiento de las ventanas se muestra como un porcentaje del
        tamaño de la ventana (un solapamiento del 50\% significa que dos
        ventanas contiguas comparten un área igual a la mitad del tamaño de la
        ventana completa).
        Para las fuentes equivalentes potenciadas por gradiente, la
        \acs{RMSE} y los tiempos de cómputo son valores medios (las barras de
        error corresponden a una desviación estándar) de los resultados
        obtenidos utilizando diferentes semillas para el generador de números
        pseudo-aleatorios.
        Los tiempos de cómputo se muestran como la relación entre el tiempo
        necesario para estimar los coeficientes de las fuentes equivalentes
        potenciadas por el gradiente y el necesario para estimar los
        coeficientes de las fuentes equivalentes regulares.
    }
    \label{fig:gradient-boosted-comparison}
\end{figure}

Estos resultados muestran que los errores de interpolación obtenidos con
potenciación del gradiente son generalmente mayores que el error obtenido por
las fuentes equivalentes regulares.
Los errores decrecen asintóticamente hasta el $\sim 40\%$ de las fuentes
equivalentes regulares para ventanas con un área mayor que el $\sim 10\%$
de la región de estudio.
Los tiempos de cómputo decrecen similarmente con el tamaño de la ventana,
siendo las fuentes potenciadas por gradiente usualmente más rápidas que las
fuentes regulares para ventanas con áreas mayores que el $\sim 5\%$ de la
región de estudio.
A medida que el tamaño de la ventana aumenta, tanto la \ac{RMSE} y el tiempo de
cómputo parece estabilizarse cerca de niveles constantes.

\subsubsection{Solapamiento de las ventanas}

La cantidad de solapamiento entre ventanas contiguas juega un rol importante en
el desempeño de las fuentes potenciadas por gradiente.
Controla la cantidad de iteraciones y cuántas veces una fuente particular será
utilizada en el proceso de ajuste por mínimos cuadrados.
Los experimentos realizados en la sección anterior muestran que un solapamiento
de 50\% es suficiente para alcanzar una precisión aceptable en las
interpolaciones.
Sin embargo, hemos estudiado de forma independiente cómo la cantidad de
solapamiento impacta tanto en la precisión como en el tiempo de cómputo.

Llevamos a cabo un experimento similar al realizado en la
sección~\ref{sec:window_size}, pero esta vez mantuvimos el tamaño de la ventana
fijo a \BoostOverlappingWindowSize{} y variamos la cantidad de solapamiento
entre 0\% y 95\% con un paso de 5\%.
Todos los otros procedimientos experimentales se mantuvieron intactos.
La Figura~\ref{fig:gradient-boosted-comparison}b
muestra la \ac{RMSE} y la
Figura~\ref{fig:gradient-boosted-comparison}d
el tiempo de cómputo requerido para estimar los coeficientes de las fuentes,
ambos en función de la cantidad de solapamiento entre las ventanas.

Nuestros resultados muestran que la \ac{RMSE} de la interpolación decrece con
la cantidad de solapamiento, alcanzando la misma precisión que las fuentes
equivalentes regulares a aproximadamente un solapamiento del 90\%.
Por otro lado, el tiempo de cómputo aumenta con la cantidad de solapamiento,
haciéndose mayor que el necesario por fuentes equivalentes regulares para
solapamientos mayores al 70\%.
Este comportamiento era de esperarse, ya que un aumento en el solapamiento
aumenta la cantidad de iteraciones en el proceso de potenciación del gradiente,
sin reducir el tamaño de los problemas de mínimos cuadrados de forma tal que se
compensen.


\subsection{
    Interpolación con potenciación del gradiente
}
\label{sec:gb_interpolation}

Finalmente, hemos aplicado las fuentes equivalentes potenciadas por gradiente
para interpolar la muestra sintética aérea (fig.~\ref{fig:synthetic-layouts}).
Tal y como hemos realizado anteriormente, utilizamos las fuentes promediadas
por bloque con un tamaño de bloque de \EqlBoostAirborneSpacing{}.
Basado en los resultados de la sección \ref{sec:window_size_and_overlap},
adoptamos un solapamiento entre ventanas contiguas de 50\% y un tamaño de
ventanas de \EqlBoostAirborneWindowSize{}.

Hemos estimado la profundidad relativa de las fuentes y el parámetro de
\emph{amortiguamiento} comparando las predicciones con los valores de la
\emph{grilla objetivo}.
Durante la búsqueda, exploramos valores de profundidad relativa entre
\EqlBoostAirborneMinDepth{} y
\EqlBoostAirborneMaxDepth{} y de valores de \emph{amortiguamiento} entre
\EqlBoostAirborneMinDamping{} y \EqlBoostAirborneMaxDamping{}
de a pasos de un orden magnitud.
Las predicciones más precisas alcanzaron una \ac{RMSE} de
\EqlBoostAirborneRmsScore{} con una profundidad relativa de
\EqlBoostAirborneDepth{} y
un \emph{amortiguamiento} de \EqlBoostAirborneDamping{}.
Vale la pena notar que la \ac{RMSE} alcanzada por las fuentes potenciadas por
gradiente es comparable con los valores obtenidos por las fuentes equivalentes
regulares en la sección~\ref{sec:synthetic_distributions}.
Para resaltar la importancia de aleatorizar el orden en el que se recorren las
ventanas durante la potenciación del gradiente, llevamos a cabo la misma
interpolación una vez más haciendo uso de los mismos valores para la profundidad
relativa y el \emph{amortiguamiento}, pero esta vez iteramos sobre las ventanas
en orden secuencial (de Sur a Norte, de Oeste a Este).

\begin{figure}[t!]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/eql-gradient-boosted/eql-boost-airborne.pdf}
    \caption{
        Error de la interpolación obtenida a partir de fuentes equivalentes
        potenciadas por gradiente utilizando un (a) orden aleatorio y un (b)
        orden secuencial para recorrer las ventanas.
        (a and b)~Mapas de las diferencias entre la \emph{grilla objetivo}
        y los resultados de la interpolación de la muestra sintética aérea.
        La escala de colores fue truncada al mismo rango de valores que la de
        la Figura~\ref{fig:airborne-survey-differences}.
        (c)~\acl{RMSE} luego de cada iteración del algoritmo de potenciación del
        gradiente.
}
\label{fig:eql-boost-airborne}
\end{figure}

Las Figuras~\ref{fig:eql-boost-airborne}a-b
muestran las diferencias entre la \emph{grilla objetivo} y los resultados de la
interpolación obtenida con ventanas en orden aleatorio y en orden secuencial,
respectivamente.
Las diferencias para las ventanas en orden aleatorio se asemejan a las
obtenidas por las fuentes equivalentes regulares que vimos en las
Figuras~\ref{fig:ground-survey-differences}
y \ref{fig:airborne-survey-differences}.
Por otro lado, las diferencias para las ventanas en orden secuencial muestran
una clara tendencia de grandes diferencias negativas hacia el Sur, decreciendo
hacia el Norte.
Esta tendencia se correlaciona con el orden en el que las ventanas son
ejecutadas, con diferencias que van decreciendo en valor absoluto hacia el
final del algoritmo.
La Figura~\ref{fig:eql-boost-airborne}c
muestra la \ac{RMSE} del proceso de ajuste luego de cada iteración, tanto para
ventanas ejecutadas en orden aleatorio como secuencial, indicando claramente
que las ventanas aleatorias generan una convergencia más rápida del algoritmo.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Grillado de datos gravimétricos de Australia}

\begin{figure}[p]
    \includegraphics[width=\linewidth]{figs/eql-gradient-boosted/australia.png}
    \caption{
        Mapas de los valores observados (a y c) y valores interpolados (b y d)
        de disturbio de gravedad sobre Australia.
        Los valores observados en a y c se muestran como círculos coloreados.
        El rectángulo rojo con línea de a trazos señala la zona representada en
        los mapas c y d.
        Las observaciones son una porción de una compilación de
        \citet{wynne2018} compuesta por 1.7 millones de mediciones de
        aceleración de la gravedad sobre el terreno.
        Los valores interpolados fueron obtenidos mediante la aplicación de
        fuentes equivalentes potenciadas por gradiente y calculados sobre una
        grilla regular a una altitud de \AustraliaEqlGridHeight{} sobre la
        superficie del elipsoide WGS84.
    }
    \label{fig:australia}
\end{figure}

En esta sección demostraremos cómo podemos utilizar las fuentes equivalentes
potenciadas por gradiente para interpolar grandes cantidades de datos sobre
una grilla regular a una altitud uniforme.
Para esto, hemos seleccionado una compilación de acceso abierto de muestras de
datos de aceleración de gravedad sobre Australia realizada por
\citet{wynne2018} y filtradas y referenciadas al elipsoide WGS84 por
\citet{australia_compilation}.
Contiene 1.7 millones de datos y cubre la mayor parte del territorio
australiano.
Nuestro objetivo es crear una grilla regular de disturbios de gravedad a una
altitud geométrica constante de \AustraliaEqlGridHeight{} (la altitud de
observación más alta presente en los datos).

Hemos calculado el disturbio de gravedad quitando la gravedad normal generada
por el elipsoide WGS84 sobre los datos de gravedad observados
(fig.~\ref{fig:australia}).
Los valores de gravedad normal fueron calculados en cada punto de observación
mediante la fórmula cerrada de \citet{ligotze2001} (ver
sección~\ref{sec:normal-gravity-closed-form}) implementada en la librería Boule
\citep{boule2020}.
Finalmente, transformamos las coordenadas de los puntos de observación a un
sistema de coordenadas planas aplicando una proyección de Mercator.

Comenzamos el proceso de interpolación definiendo un conjunto de \emph{fuentes
promediadas por bloque} haciendo uso de bloques de 1.8\km{} de lado, obteniendo
un total de \AustraliaEqlNSources{}~fuentes puntuales.
El tamaño de los bloques fue elegido para que concuerde con la resolución
deseada para la grilla final (1~minuto de arco equivale aproximadamente
a 1.8\km{} en el ecuador).
Basado en los resultados obtenidos en la
sección~\ref{sec:synthetic_distributions}, elegimos localizar las fuentes
siguiendo la estrategia de \emph{profundidad relativa}.
El solapamiento de las ventanas fue fijado nuevamente a 50\%.
Para determinar el tamaño de las ventanas, calculamos la cantidad de memoria
necesaria para almacenar la matriz Jacobiana más grande que genera el algoritmo
para diferentes valores de tamaño de ventana
(fig.~\ref{fig:australia-memory-cv-error}a).
Hemos seleccionado un tamaño de ventana de \AustraliaEqlWindowSize{} con el
objetivo de limitar la cantidad de memoria por debajo de los 16~Gigabytes.

\begin{figure}[p]
    \centering
    \includegraphics[width=0.6\linewidth]{figs/eql-gradient-boosted/australia-memory-cv-error.pdf}
    \caption{
        (a) Cantidad de memoria computacional necesaria para almacenar la mayor
        matriz Jacobiana en función del tamaño de las ventanas. Nuestra
        implementación de algoritmo almacena los elementos de la matriz como
        puntos flotantes de doble precisión (64 bits).
        (b) \acs{RMSE} entre los valores observados y los valores predichos
        sobre cada punto de observación luego de cada iteración del algoritmo
        de potenciación del gradiente.
        (c) \acs{RMSE} obtenidas de la validación cruzada de K iteraciones para
        pares de valores de \emph{amortiguamiento} y profundidad relativa de
        las fuentes.
        La estrella naranja señala la \acs{RMSE} mínima.
    }
    \label{fig:australia-memory-cv-error}
\end{figure}

Hemos determinados la profundidad relativa de las fuentes y el parámetro de
\emph{amortiguamiento} aplicando una validación cruzada de K iteraciones
(\emph{K-Fold cross-validation} en inglés) mediante la librería scikit-learn
\citep{sklearn2011}.
Este método divide aleatoriamente los datos originales en $k$ conjuntos
(denominados \emph{folds}), ajusta el modelo de fuentes equivalentes utilizando
sólo los datos de $k - 1$ conjuntos y valida el modelo comparando sus
predicciones sobre los puntos pertenecientes al conjunto restante.
Este proceso se lleva a cabo una vez por cada uno de los $k$ conjuntos,
obteniendo una media de las \ac{RMSE} para dicho modelo.
Con el objetivo de acelerar el cómputo, realizamos la validación cruzada sobre
un subconjunto de los datos originales correspondientes a un área de
\AustraliaSmallAreaEastingSize{}$\times$\AustraliaSmallAreaNorthingSize{}
que contiene \AustraliaSmallAreaNPoints{} puntos.
Llevamos a cabo la validación cruzada repetidamente para combinaciones de la
profundidad relativa con valores entre \AustraliaDepthMin{}
y \AustraliaDepthMax{}, y el parámetro de \emph{amortiguamiento} con valores
entre \AustraliaDampingMin{} y \AustraliaDampingMax{} con pasos de un orden de
magnitud.
La figura~\ref{fig:australia-memory-cv-error}c muestra los valores de \ac{RMSE}
obtenidas a partir de la validación cruzada y señala su mínimo valor alcanzado
de \AustraliaEqlRmsScore{}, el cual corresponde a una profundidad relativa de
\AustraliaEqlDepth{} y un \emph{amortiguamiento} de \AustraliaEqlDamping{}.

Finalmente, procedemos a estimar los coeficientes de las fuentes utilizando el
conjunto completo de datos y los parámetros determinados con anterioridad.
Los coeficientes de las fuentes fueron utilizados luego para predecir valores
del disturbio de gravedad sobre una grilla regular de
\AustraliaEqlGridNLongitude{}$\times$\AustraliaEqlGridNLatitude{} puntos a una
altitud de
\AustraliaEqlGridHeight{} por encima del elipsoide.
En una computadora de modestas especificaciones con 16 núcleos y 16~Gigabytes
de RAM, la estimación de los coeficientes de las \AustraliaEqlNSources{}
fuentes mediante el algoritmo de potenciación del gradiente tomó
aproximadamente 1.3~horas, y la predicción sobre los puntos de la grilla,
18~minutos.

La figura~\ref{fig:australia}
muestra la distribución de datos originales y la grilla de valores
interpolados.
Los puntos de la grilla que se encuentran más allá de 50\km{} del punto de
datos más cercano fueron enmascarados para evitar extrapolaciones irreales.
La figura~\ref{fig:australia-memory-cv-error}b muestra la \ac{RMSE} entre los
datos observados y las predicciones del modelo luego de cada iteración del
algoritmo.
La figura~\ref{fig:australia-residuals}
muestra un mapa de los residuos, es decir, la diferencia entre los valores
observados y predichos del disturbio de gravedad.
La pequeña gráfica insertada muestra un histograma de los residuos, los cuales
se encuentran normalmente distribuidos alrededor de cero.

\begin{figure}[t!]
    \centering
    \includegraphics[width=0.7\linewidth]{figs/eql-gradient-boosted/australia-residuals.png}
    \caption{
        Residuos.
        Diferencias entre el disturbio de gravedad observado sobre Australia
        y los valores predichos por las fuentes equivalentes estimadas sobre
        los mismos puntos de observación.
        La escala de colores ha sido truncada para mejorar la visualización
        alrededor de la porción mayoritaria de los valores de residuos.
        El gráfico insertado muestra un histograma de los residuos.
    }
    \label{fig:australia-residuals}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Discusión}

\subsection{Ubicación de las fuentes}

Los resultados de nuestras pruebas sobre datos sintéticos
(figs.~\ref{fig:ground-survey-differences}
y~\ref{fig:airborne-survey-differences})
muestran que no hay diferencias significativas sobre la precisión de la
interpolación entre las diferentes estrategias de distribución de las fuentes,
tanto en términos de la \ac{RMSE} así como también a partir de inspecciones
visuales de los mapas de diferencias.
Por lo tanto podemos concluir que todas las estrategias de distribución de las
fuentes son capaces de producir interpolaciones de calidad comparable.
Sin embargo, las \emph{fuentes promediadas por bloque} hacen uso de menor
cantidad de fuentes si las comparamos con las otras estrategias, lo que reduce
el costo computacional involucrado en la estimación de sus parámetros y en el
modelado directo.
Para garantizar que las interpolaciones sean capaces de reproducir las altas
frecuencias presentes en los datos, el tamaño de los bloques utilizados en
durante el promediado debe ser elegido de forma tal que se corresponda con la
resolución deseada en la grilla resultante.

La elección de la profundidad de las fuentes no aparenta tener un impacto
significativo sobre el error de interpolación.
En el caso particular de una muestra dispersa sobre terreno
con \emph{fuentes promediadas por bloque}, el uso de profundidades variables
reduce visiblemente los efectos de borde y la presencia de artefactos en áreas
con poca cobertura.
A primera vista, la elección de una estrategia particular para elegir la
profundidad de las fuentes no parecería tener impacto sobre el tiempo de
cómputo.
Sin embargo, la búsqueda del conjunto de hiperparámetros que produce la
interpolación más precisa (por ejemplo, mediante validación cruzada), uno debe
resolver el problema inverso una vez por cada combinación posible de los
parámetros.
Una estrategia como la de \emph{profundidad variable} requiere una mayor
cantidad de parámetros a ser determinados (el desplazamiento relativo $\Delta
z$, el factor de profundidad $\alpha$, y la cantidad de vecinos cercanos $k$
presentes en la ec.~\ref{eq:variable_depth})
en comparación con las otras que sólo requieren uno solo.
La presencia de un mayor número de parámetros significa incrementar las
dimensiones del espacio de parámetros y por ende, aumentar la cantidad de
posibles combinaciones.
Por lo tanto, recomendamos utilizar una \emph{profundidad constante} o una
\emph{profundidad relativa} al procesar grandes cantidades de datos con el
objetivo de minimizar el tiempo de cómputo.

\subsection{Potenciación del gradiente}

A partir de la figura~\ref{fig:gradient-boosted-comparison}a
y~\ref{fig:gradient-boosted-comparison}c,
podemos ver que las fuentes equivalentes potenciadas por gradiente producen
interpolaciones ligeramente menos precisas que las fuentes equivalentes
regulares, pero son capaces de alcanzar menores tiempos de cómputo.
La reducción en la precisión puede ser debida a que el algoritmo de
potenciación del gradiente no consigue converger al mínimo global de la función
objetivo.
A medida que las ventanas aumentan en tamaño, los errores de interpolación
decrecen debido a que mayor cantidad de puntos son incluidos dentro del ajuste
por mínimos cuadrados.
Al mismo tiempo, el proceso de ajuste se vuelve más rápido debido a la
reducción en la cantidad de iteraciones.
Nuestros resultados indican que es deseable maximizar el tamaño de las
ventanas, lo cual puede hacerse mientra las matrices Jacobianas involucradas
puedan ser almacenadas en la memoria disponible.

Los resultados mostrados en las figuras~\ref{fig:gradient-boosted-comparison}b
y~\ref{fig:gradient-boosted-comparison}d
indican que valores de solapamiento entre 40\% y 70\% logran un balance entre
la precisión de la interpolación y el tiempo de cómputo.
Esto corrobora nuestra elección inicial de solapamiento de 50\%, la cual es
suficientemente bueno para producir interpolaciones precisas en tiempos
razonables.

Finalmente, los resultados expuestos en la figura~\ref{fig:eql-boost-airborne}
señalan la importancia de aleatorizar el orden en el que las ventanas son
iteradas.
Corriendo el algoritmo de potenciación del gradiente secuencialmente produce
predicciones significativamente menos precisas y expone una menor velocidad de
convergencia del método.

\subsection{Datos gravimétricos sobre Australia}

La aplicación de las fuentes equivalentes potenciadas por gradiente a los datos
de aceleración de gravedad sobre Australia demuestra que el método es capaz de
interpolar y realizar continuaciones ascendentes sobre grandes cantidades de
datos en tiempos razonables utilizando recursos computacionales modestos.
La grilla resultante (fig.~\ref{fig:australia}) preserva la alta resolución de
los datos originales mientras evita artefactos de \emph{aliasing} debido al
promediado de las ubicaciones de las fuentes.
Algunas porciones de la grilla se observan más suaves y con menores amplitudes
que los datos originales (por ejemplo, porciones ubicadas al sudoeste), las
cuales son esperables luego de aplicar continuaciones ascendentes.
A partir del análisis de validación cruzada sobre una porción de los datos,
estimamos que el error de las interpolaciones es de aproximadamente
\AustraliaEqlRmsScore{}.

Los residuos más altos que se aprecian en la figura~\ref{fig:australia-residuals}
están ubicados en regiones en las cuales los datos presentan señales de alta
amplitud y longitud de onda corta.
Este comportamiento es esperable, ya que el método involucra algún grado de
suavizado debido al uso del término de \emph{amortiguamiento} y de la elección
de la profundidad de las fuentes.
Existen además residuos cuyas señales poseen bajas amplitudes y largas
longitudes de onda que parecen coincidir con las áreas ocupadas por algunas de
las ventanas del algoritmo de potenciación del gradiente.
Una posible causa de estos artefactos es la inhabilidad de las fuentes
equivalentes dentro de ventanas particulares de ajustar adecuadamente
las componentes de largas longitudes de onda.
Vale notar, sin embargo, que estos residuos de larga longitud de onda poseen
amplitudes menores a 1\mGal{} y no representan una fuente de errores
significativa .

Los valles alargados alrededor del valor mínimo de la \ac{RMSE} obtenida
durante la validación cruzada (fig.~\ref{fig:australia-memory-cv-error}c
muestran que existe cierta ambigüedad en la elección del parámetro de
\emph{amortiguamiento} y la profundad de las fuentes.
Uno podría elegir un valor alto de \emph{amortiguamiento} junto a fuentes
someras o bien valores pequeños de \emph{amortiguamiento} junto a fuentes
profundas y alcanzar aproximadamente los mismos resultados.
Esto es esperable, ya que ambos parámetros controlan la suavidad de la
interpolación.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusiones}

La técnica de fuentes equivalentes ha probado ser altamente adecuada para
interpolar disturbios de gravedad y anomalías magnéticas.
Las dos razones principales que la hacen sobresalir por encima de otros
interpoladores bidimensionales es el hecho que las fuentes equivalentes toman
en cuenta la altitud de las observaciones y que los valores interpolados
representan siempre funciones harmónicas.
El principal desafío a la hora de utilizar fuentes equivalentes en la práctica
es el alto costo computacional que surge al estimar los coeficientes de las
fuentes, especialmente los requerimientos en memoria para almacenar la matriz
Jacobiana.

Presentamos dos estrategias que pueden ser simultáneamente aplicadas a la
interpolación de conjuntos de datos con millones de puntos en cualquier
hardware modesto: las \emph{fuentes promediadas por bloque}, que reducen el
número de fuentes necesarias para la interpolación, y las \emph{fuentes
equivalentes potenciadas por gradiente}, que dividen el problema inverso en
conjuntos más pequeños de fuentes equivalentes definidos por ventanas
solapadas.
Ambos métodos fueron probados sobre datos sintéticos con el objetivo de compara
su precisión y cómo se desenvuelven en términos de eficiencia computacional.

Nuestros resultados muestran que las \emph{fuentes promediadas por bloque}
reducen el costo computacional necesario para estimar los coeficientes de las
fuentes en comparación con dos estrategias clásicas (ubicar fuentes debajo de
cada punto de observación o en grillas regulares).
Mostramos además que esta reducción del número de fuentes no afecta la
precisión de las predicciones.
El uso de \emph{fuentes promediadas por bloque} podría también ayudar
a prevenir efectos de \emph{aliasing} en los valores interpolados,
especialmente cuando las observaciones se encuentran anisotrópicamente
distribuidas (por ejemplo en muestreos aéreos o navales).
Se debe prestar especial atención durante la elección del tamaño de los
bloques.
A modo de \emph{regla del pulgar}, recomendamos elegir un tamaño
aproximadamente igual al de la resolución deseada de la grilla regular sobre la
cual los valores serán interpolados.

Las pruebas realizadas para comparar las estrategias para ubicar las fuentes
verticalmente muestran que cualquiera de las aquí sugeridas
(\emph{profundidad constante}, \emph{profundidad relativa} y \emph{profundidad
variable})
producen interpolaciones con precisiones comparables.
Sin embargo, nos vemos inclinados a recomendar el uso de \emph{profundidad
constante} o \emph{profundidad relativa} para la mayoría de las aplicaciones, ya
que involucran menor cantidad de hiperparámetros que serán necesarios
configurar antes de realizar la interpolación.

Las fuentes equivalentes potenciadas por gradiente reducen significativamente
la memoria necesaria para estimar los coeficientes de las fuentes, permitiendo
interpolar grandes conjuntos de datos con millones de puntos, que de otra forma
producirían matrices Jacobianas imposibles de almacenar en las cantidades de
memoria disponibles en computadoras personales modernas.
Las interpolaciones obtenidas mediante este nuevo método alcanzan
aproximadamente la misma precisión que las fuentes equivalentes regulares,
mientras reducen el tiempo de cómputo por aproximadamente un factor de 3.
Mostramos además que un solapamiento de 50\% entre ventanas contiguas alcanza
un buen compromiso entre precisión y tiempo de cómputo.
El tamaño de las ventanas debe ser elegido como el máximo valor posible que
cree matrices Jacobianas lo suficientemente pequeñas que puedan ser
almacenadas en la memoria disponible.
Además, aleatorizar el orden en el que las ventanas son iteradas aumenta la
velocidad de convergencia del algoritmo y resulta esencial para producir
predicciones precisas.

El método de potenciación del gradiente puede ser utilizado en conjunción con
cualquier distribución horizontal de las fuentes, estrategia para elegir sus
profundidades o tipo de fuente (por ejemplo, fuentes puntuales, prismas,
tesseroides, etc), ya que no depende de ninguna suposición acerca de las
fuentes.
Futuros trabajos podrían dedicarse a investigar la aplicación del algoritmo de
potenciación del gradiente a otros métodos de fuentes equivalentes.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Disponibilidad de datos y código}

El código fuente en Python utilizado para producir todos los resultados
y figuras presentados en este trabajo se encuentra disponible en
\citet{soler2021b} y \url{https://github.com/compgeolab/eql-gradient-boosted}
bajo la licencia de código abierto BSD 3-clause.

La implementación de las fuentes equivalentes potenciadas por gradiente se
encuentra basada en la implementación de fuentes equivalentes presente en la
librería Harmonica \citep{harmonica2021}.
Entre otros software utilizados en este estudio se incluyen:
Pooch \citep{pooch2020} para descargar y almacenar conjuntos de datos,
Verde \citep{verde2018} para reducciones por bloques y manipulación de
coordenadas,
Boule \citep{boule2020} para el cálculo de gravedad normal,
xarray \citep{xarray2017} y NumPy \citep{numpy2020}
para el manejo de arreglos multidimensionales y para cálculos numéricos,
Numba \citep{numba2015} para compilaciones en tiempo de ejecución
y paralelizaciones,
scikit-learn \citep{sklearn2011} para validaciones cruzadas,
Matplotlib \citep{matplotlib2007} y PyGMT \citep{pygmt2020}
para la generación de figuras y mapas,
y el ambiente de programación Jupyter \citep{jupyter2016}.
Harmonica, Boule, Pooch, y Verde son partes del proyecto Fatiando a Terra
\citep{uieda2013}.

Todos los datos utilizados son de acceso abierto y disponibles públicamente.
Las muestras sintéticas fueron generadas utilizando un conjunto de datos de
gravedad sobre Sudáfrica de dominio público, distribuidos por el
NOAA NCEI (\url{https://www.ngdc.noaa.gov/mgg/gravity/gravity.html}),
y la Great Britain Aeromagnetic Survey distribuida por la
British Geological Survey (BGS) bajo una Open Government License
(\url{https://www.bgs.ac.uk/products/geophysics/aeromagneticRegional.html}).
El relieve sombreado presente en la figura.~\ref{fig:australia} corresponde al
SRTM15+ de \citet{tozer2019}.
Los datos de gravedad sobre Australia están basados en una compilación
distribuida por Geoscience Australia bajo una Creative Commons Attribution 4.0
International Licence \citep{wynne2018}, los cuales fueron filtrados
y referenciados al elipsoide WGS84 por \citet{australia_compilation}, que a su
vez se distribuye bajo la misma licencia
(\url{https://doi.org/10.6084/m9.figshare.13643837}).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{subappendices}

\section[%
    Parámetros para localizar fuentes equivalentes en pruebas con datos sintéticos
]{%
    Parámetros para localizar fuentes equivalentes en pruebas con datos sintéticos
}
\sectionmark{Parámetros de fuentes equivalentes}

\label{sec:sources}

Las tablas~\ref{tab:parameters-ground-survey}
y~\ref{tab:parameters-airborne-survey} muestran valores de parámetros
utilizados para analizar estrategias de distribución de fuentes equivalentes
con datos sintéticos (sección~\ref{sec:synthetic_distributions}, junto con los
valores óptimos correspondientes a cada estrategia.
Estos valores óptimos fueron utilizados para producir los resultados de las
figuras~\ref{fig:ground-survey-differences}
y~\ref{fig:airborne-survey-differences}.


\begin{table}[h]
    \centering
    \caption{
        Parámetros utilizados para producir cada distribución de fuentes
        durante la interpolación de datos sintéticos sobre terreno.
        Contiene además el conjunto de parámetros que genera el menor
        \acs{RMSE} para cada estrategia de distribución de fuentes y su
        correspondiente valor.
    }
    \label{tab:parameters-ground-survey}
    {\scriptsize % reduce size of table to fit paper width
    \begin{tabular}{c c l c c c}
        \textbf{Distribución}
            & \textbf{Profundidad}
            & \multicolumn{1}{c}{\textbf{Parámetros}}
            & \textbf{Valores}
            & \textbf{Óptimo}
            & \textbf{RMSE} \\
        \toprule

        \multirow{8}{*}{Debajo de datos}
            & \multirow{2}{*}{Constante}
                & Profundidad (m)
                & \GroundSourceBelowDataConstantDepthDepth
                & \BestGroundSourceBelowDataConstantDepthDepth
                & \multirow{2}{*}{
                    \BestGroundSourceBelowDataConstantDepthRms
                  } \\
            &
                & Amortiguamiento
                & \GroundSourceBelowDataConstantDepthDamping
                & \BestGroundSourceBelowDataConstantDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{2}{*}{Relativa}
                & Profundidad (m)
                & \GroundSourceBelowDataRelativeDepthDepth
                & \BestGroundSourceBelowDataRelativeDepthDepth
                & \multirow{2}{*}{
                    \BestGroundSourceBelowDataRelativeDepthRms
                  } \\
            &
                & Amortiguamiento
                & \GroundSourceBelowDataRelativeDepthDamping
                & \BestGroundSourceBelowDataRelativeDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{4}{*}{Variable}
                & Profundidad (m)
                & \GroundSourceBelowDataVariableDepthDepth
                & \BestGroundSourceBelowDataVariableDepthDepth
                & \multirow{4}{*}{
                    \BestGroundSourceBelowDataVariableDepthRms
                  } \\
            &
                & Factor de profundidad
                & \GroundSourceBelowDataVariableDepthDepthFactor
                & \BestGroundSourceBelowDataVariableDepthDepthFactor
                & \\
            &
                & $k$ vecinos cercanos
                & \GroundSourceBelowDataVariableDepthKNearest
                & \BestGroundSourceBelowDataVariableDepthKNearest
                & \\
            &
                & Amortiguamiento
                & \GroundSourceBelowDataVariableDepthDamping
                & \BestGroundSourceBelowDataVariableDepthDamping
                & \\
        \midrule

        \multirow{11}{*}{Promed. por bloque}
            & \multirow{3}{*}{Constante}
                & Profundidad (m)
                & \GroundBlockAveragedSourcesConstantDepthDepth
                & \BestGroundBlockAveragedSourcesConstantDepthDepth
                & \multirow{3}{*}{
                    \BestGroundBlockAveragedSourcesConstantDepthRms
                  } \\
            &
                & Tamaño de bloque (m)
                & \GroundBlockAveragedSourcesConstantDepthSpacing
                & \BestGroundBlockAveragedSourcesConstantDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \GroundBlockAveragedSourcesConstantDepthDamping
                & \BestGroundBlockAveragedSourcesConstantDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{3}{*}{Relativa}
                & Profundidad (m)
                & \GroundBlockAveragedSourcesRelativeDepthDepth
                & \BestGroundBlockAveragedSourcesRelativeDepthDepth
                & \multirow{3}{*}{
                    \BestGroundBlockAveragedSourcesRelativeDepthRms
                  } \\
            &
                & Tamaño de bloque (m)
                & \GroundBlockAveragedSourcesRelativeDepthSpacing
                & \BestGroundBlockAveragedSourcesRelativeDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \GroundBlockAveragedSourcesRelativeDepthDamping
                & \BestGroundBlockAveragedSourcesRelativeDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{5}{*}{Variable}
                & Profundidad (m)
                & \GroundBlockAveragedSourcesVariableDepthDepth
                & \BestGroundBlockAveragedSourcesVariableDepthDepth
                & \multirow{5}{*}{
                    \BestGroundBlockAveragedSourcesVariableDepthRms
                  } \\
            &
                & Factor de profundidad
                & \GroundBlockAveragedSourcesVariableDepthDepthFactor
                & \BestGroundBlockAveragedSourcesVariableDepthDepthFactor
                & \\
            &
                & $k$ vecinos cercanos
                & \GroundBlockAveragedSourcesVariableDepthKNearest
                & \BestGroundBlockAveragedSourcesVariableDepthKNearest
                & \\
            &
                & Tamaño de bloque (m)
                & \GroundBlockAveragedSourcesVariableDepthSpacing
                & \BestGroundBlockAveragedSourcesVariableDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \GroundBlockAveragedSourcesVariableDepthDamping
                & \BestGroundBlockAveragedSourcesVariableDepthDamping
                & \\
        \midrule

        \multirow{4}{*}{Grilla regular}
            & \multirow{4}{*}{Constante}
                & Profundidad (m)
                & \GroundGridSourcesConstantDepthDepth
                & \BestGroundGridSourcesConstantDepthDepth
                & \multirow{4}{*}{
                    \BestGroundGridSourcesConstantDepthRms
                  } \\
            &
                & Espaciado de grilla (m)
                & \GroundGridSourcesConstantDepthSpacing
                & \BestGroundGridSourcesConstantDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \GroundGridSourcesConstantDepthDamping
                & \BestGroundGridSourcesConstantDepthDamping
                & \\
    \end{tabular}
    }
\end{table}

\begin{table}[h]
    \centering
    \caption{
        Parámetros utilizados para producir cada distribución de fuentes
        durante la interpolación de datos sintéticos aéreos.
        Contiene además el conjunto de parámetros que genera el menor
        \acs{RMSE} para cada estrategia de distribución de fuentes y su
        correspondiente valor.
    }
    \label{tab:parameters-airborne-survey}
    {\scriptsize % reduce size of table to fit paper width
    \begin{tabular}{c c l c c c}
        \textbf{Distribución}
            & \textbf{Profundidad}
            & \multicolumn{1}{c}{\textbf{Parámetros}}
            & \textbf{Valores}
            & \textbf{Óptimo}
            & \textbf{RMSE} \\
        \toprule

        \multirow{8}{*}{Debajo de datos}
            & \multirow{2}{*}{Constante}
                & Profundidad (m)
                & \AirborneSourceBelowDataConstantDepthDepth
                & \BestAirborneSourceBelowDataConstantDepthDepth
                & \multirow{2}{*}{
                    \BestAirborneSourceBelowDataConstantDepthRms
                  } \\
            &
                & Amortiguamiento
                & \AirborneSourceBelowDataConstantDepthDamping
                & \BestAirborneSourceBelowDataConstantDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{2}{*}{Relativa}
                & Profundidad (m)
                & \AirborneSourceBelowDataRelativeDepthDepth
                & \BestAirborneSourceBelowDataRelativeDepthDepth
                & \multirow{2}{*}{
                    \BestAirborneSourceBelowDataRelativeDepthRms
                  } \\
            &
                & Amortiguamiento
                & \AirborneSourceBelowDataRelativeDepthDamping
                & \BestAirborneSourceBelowDataRelativeDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{4}{*}{Variable}
                & Profundidad (m)
                & \AirborneSourceBelowDataVariableDepthDepth
                & \BestAirborneSourceBelowDataVariableDepthDepth
                & \multirow{4}{*}{
                    \BestAirborneSourceBelowDataVariableDepthRms
                  } \\
            &
                & Factor de profundidad
                & \AirborneSourceBelowDataVariableDepthDepthFactor
                & \BestAirborneSourceBelowDataVariableDepthDepthFactor
                & \\
            &
                & $k$ vecinos cercanos
                & \AirborneSourceBelowDataVariableDepthKNearest
                & \BestAirborneSourceBelowDataVariableDepthKNearest
                & \\
            &
                & Amortiguamiento
                & \AirborneSourceBelowDataVariableDepthDamping
                & \BestAirborneSourceBelowDataVariableDepthDamping
                & \\
        \midrule

        \multirow{11}{*}{Prom. por bloque}
            & \multirow{3}{*}{Constante}
                & Profundidad (m)
                & \AirborneBlockAveragedSourcesConstantDepthDepth
                & \BestAirborneBlockAveragedSourcesConstantDepthDepth
                & \multirow{3}{*}{
                    \BestAirborneBlockAveragedSourcesConstantDepthRms
                  } \\
            &
                & Tamaño de bloque (m)
                & \AirborneBlockAveragedSourcesConstantDepthSpacing
                & \BestAirborneBlockAveragedSourcesConstantDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \AirborneBlockAveragedSourcesConstantDepthDamping
                & \BestAirborneBlockAveragedSourcesConstantDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{3}{*}{Relativa}
                & Profundidad (m)
                & \AirborneBlockAveragedSourcesRelativeDepthDepth
                & \BestAirborneBlockAveragedSourcesRelativeDepthDepth
                & \multirow{3}{*}{
                    \BestAirborneBlockAveragedSourcesRelativeDepthRms
                  } \\
            &
                & Tamaño de bloque (m)
                & \AirborneBlockAveragedSourcesRelativeDepthSpacing
                & \BestAirborneBlockAveragedSourcesRelativeDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \AirborneBlockAveragedSourcesRelativeDepthDamping
                & \BestAirborneBlockAveragedSourcesRelativeDepthDamping
                & \\
            \cmidrule{2-6}
            & \multirow{5}{*}{Variable}
                & Profundidad (m)
                & \AirborneBlockAveragedSourcesVariableDepthDepth
                & \BestAirborneBlockAveragedSourcesVariableDepthDepth
                & \multirow{5}{*}{
                    \BestAirborneBlockAveragedSourcesVariableDepthRms
                  } \\
            &
                & Factor de profundidad
                & \AirborneBlockAveragedSourcesVariableDepthDepthFactor
                & \BestAirborneBlockAveragedSourcesVariableDepthDepthFactor
                & \\
            &
                & $k$ vecinos cercanos
                & \AirborneBlockAveragedSourcesVariableDepthKNearest
                & \BestAirborneBlockAveragedSourcesVariableDepthKNearest
                & \\
            &
                & Tamaño de bloque (m)
                & \AirborneBlockAveragedSourcesVariableDepthSpacing
                & \BestAirborneBlockAveragedSourcesVariableDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \AirborneBlockAveragedSourcesVariableDepthDamping
                & \BestAirborneBlockAveragedSourcesVariableDepthDamping
                & \\
        \midrule

        \multirow{4}{*}{Grilla regular}
            & \multirow{4}{*}{Constante}
                & Profundidad (m)
                & \AirborneGridSourcesConstantDepthDepth
                & \BestAirborneGridSourcesConstantDepthDepth
                & \multirow{4}{*}{
                    \BestAirborneGridSourcesConstantDepthRms
                  } \\
            &
                & Espaciado de grilla (m)
                & \AirborneGridSourcesConstantDepthSpacing
                & \BestAirborneGridSourcesConstantDepthSpacing
                & \\
            &
                & Amortiguamiento
                & \AirborneGridSourcesConstantDepthDamping
                & \BestAirborneGridSourcesConstantDepthDamping
                & \\
    \end{tabular}
    }
\end{table}


\end{subappendices}
